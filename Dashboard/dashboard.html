<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Green Economy Toolkit - Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../Master Page(Header and Footer)/MasterPage.css">
    <script src="../Master Page(Header and Footer)/MasterPage.js"></script>
    <link rel="stylesheet" href="dashboard.css">


<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<style>
.dashboard-card {
    cursor: pointer;
    pointer-events: auto;
    position: relative;
    z-index: 1;
}
.news-item, .news-category-btn, .btn {
    cursor: pointer;
    pointer-events: auto;
    position: relative;
    z-index: 1;
}
.loader-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
}
.loader {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 5px solid #f3f3f3;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    z-index: 1000;
}
@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}
</style>


  </head>

  <div class="loader-overlay" id="loader-overlay"></div>
<div class="loader" id="loader"></div>
  <body>
    <!-- Header -->
    <green-economy-header></green-economy-header>

    <!-- Main Content -->
    <main class="main">
      <div class="container-full">
        <!-- Hero Section -->
        <section class="hero">
          <div class="hero-content">
            <h1 data-translate="dashboard-title">Dashboard Overview</h1>
            <p data-translate="dashboard-subtitle">
              Welcome to your personalized Green Economy Toolkit dashboard
            </p>
          </div>
        </section>

        <!-- AI-Enhanced Search -->
        <section class="search-section" style="margin: 0 1.5rem 3rem 1.5rem">
          <div class="search-header">
            <svg
              class="search-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
            <h3 data-translate="ai-search-title">AI-Enhanced Search</h3>
          </div>
          <div class="search-container">
            <svg
              class="search-input-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
            <input
              type="text"
              class="search-input"
              id="smartSearch"
              placeholder="Search green funding, businesses, tools..."
              data-translate-placeholder="search-placeholder"
            />
          </div>
        </section>

        <!-- Dashboard Navigation -->
        <section class="dashboard-grid" style="margin: 0 1.5rem 3rem 1.5rem">
          <div class="dashboard-card" data-section="funding">
            <svg
              class="card-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"
              ></path>
            </svg>
            <h3 class="card-title" data-translate="funding-hub-title">
              Funding Hub
            </h3>
            <p class="card-description" data-translate="funding-hub-desc">
              Explore green funding opportunities with real-time updates and
              eligibility filters.
            </p>
            <div class="card-stats">
              <span>156 Opportunities</span>
              <span>R2.4B Available</span>
            </div>
          </div>

          <div class="dashboard-card" data-section="smme">
            <svg
              class="card-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 21V5a2 2 0 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
              ></path>
            </svg>
            <h3 class="card-title" data-translate="smme-directory-title">
              SMME Directory
            </h3>
            <p class="card-description" data-translate="smme-directory-desc">
              Searchable database with business profiles and green certification
              statuses.
            </p>
            <div class="card-stats">
              <span>2,847 Businesses</span>
              <span>89% Verified</span>
            </div>
          </div>

          <div class="dashboard-card" data-section="toolkits">
            <svg
              class="card-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
              ></path>
            </svg>
            <h3 class="card-title" data-translate="toolkits-title">
              Integrated Toolkits
            </h3>
            <p class="card-description" data-translate="toolkits-desc">
              Access green economy tools and seamless redirects to external
              applications.
            </p>
            <div class="card-stats">
              <span>45 Tools</span>
              <span>12.3k Downloads</span>
            </div>
          </div>

          <div class="dashboard-card" data-section="legal">
            <svg
              class="card-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"
              ></path>
            </svg>
            <h3 class="card-title" data-translate="legal-title">
              Legal & Compliance
            </h3>
            <p class="card-description" data-translate="legal-desc">
              Clearly defined policies and limited liability statements
              integrated into the platform.
            </p>
            <div class="card-stats">
              <span>Updated Daily</span>
              <span>100% Compliant</span>
            </div>
          </div>
        </section>

        <!-- Live News Section -->
        <section class="news-section" style="margin: 0 1.5rem 3rem 1.5rem">
          <div class="news-header">
            <div class="news-title-section">
              <div class="news-icon">
                <svg
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  style="width: 1.5rem; height: 1.5rem"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"
                  ></path>
                </svg>
              </div>
              <div>
                <h3
                  style="
                    font-size: 1.25rem;
                    font-weight: 600;
                    color: var(--green-dark);
                    margin-bottom: 0.25rem;
                  "
                >
                  Green Economy News
                </h3>
                <p style="font-size: 0.875rem; color: var(--muted-foreground)">
                  Latest updates from the sustainable economy
                </p>
              </div>
            </div>
            <div class="news-live-indicator">
              <div class="live-dot"></div>
              <span
                style="
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: var(--green-primary);
                "
                >Live</span
              >
            </div>
          </div>

          <!-- Category Filter -->
          <div style="margin-bottom: 1.5rem">
            <button class="news-category-btn active" data-category="all">
              All News
            </button>
            <button class="news-category-btn" data-category="Energy">
              Energy
            </button>
            <button class="news-category-btn" data-category="Finance">
              Finance
            </button>
            <button class="news-category-btn" data-category="Business">
              Business
            </button>
            <button class="news-category-btn" data-category="Technology">
              Technology
            </button>
            <button class="news-category-btn" data-category="Education">
              Education
            </button>
          </div>

          <!-- News Grid -->
          <div id="newsGrid" class="news-grid">
            <!-- News items will be populated by JavaScript -->
          </div>

          <!-- Load More Button -->
          <div class="text-center" style="margin-bottom: 1rem">
            <button id="loadMoreNews" class="btn btn-primary">
              Load More News
            </button>
          </div>

          <!-- Refresh Button -->
          <div style="text-align: right">
            <button
              id="refreshNews"
              class="btn"
              style="background: var(--light-bg); color: var(--green-primary)"
            >
              <svg
                style="
                  width: 1rem;
                  height: 1rem;
                  margin-right: 0.5rem;
                  display: inline;
                "
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                ></path>
              </svg>
              Refresh News
            </button>
          </div>
        </section>

        <!-- User Personas Section -->
        <section class="personas-section" style="margin: 0 1.5rem 3rem 1.5rem">
          <h2 class="section-title" data-translate="personas-title">
            Built for Every Green Economy Participant
          </h2>
          <div class="personas-grid">
            <div class="persona-card">
              <svg
                class="persona-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                ></path>
              </svg>
              <h4 class="persona-title" data-translate="persona-township">
                Township IRM Enterprises
              </h4>
              <p
                class="persona-description"
                data-translate="persona-township-desc"
              >
                Guided navigation and sector-specific green solutions
              </p>
            </div>
            <div class="persona-card">
              <svg
                class="persona-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                ></path>
              </svg>
              <h4 class="persona-title" data-translate="persona-youth">
                Youth Communities
              </h4>
              <p
                class="persona-description"
                data-translate="persona-youth-desc"
              >
                Gamified learning paths and AI-driven recommendations
              </p>
            </div>
            <div class="persona-card">
              <svg
                class="persona-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V8a2 2 0 012-2V6"
                ></path>
              </svg>
              <h4 class="persona-title" data-translate="persona-partners">
                Stakeholders & Partners
              </h4>
              <p
                class="persona-description"
                data-translate="persona-partners-desc"
              >
                Advanced analytics and collaboration tools
              </p>
            </div>
            <div class="persona-card">
              <svg
                class="persona-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"
                ></path>
              </svg>
              <h4 class="persona-title" data-translate="persona-communities">
                Local Communities
              </h4>
              <p
                class="persona-description"
                data-translate="persona-communities-desc"
              >
                Community-focused resources and local opportunities
              </p>
            </div>
            <div class="persona-card">
              <svg
                class="persona-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                ></path>
              </svg>
              <h4 class="persona-title" data-translate="persona-tvet">
                TVET Colleges
              </h4>
              <p class="persona-description" data-translate="persona-tvet-desc">
                Educational resources and skills development programs
              </p>
            </div>
            <div class="persona-card">
              <svg
                class="persona-icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                ></path>
              </svg>
              <h4 class="persona-title" data-translate="persona-hubs">
                Entrepreneurial Hubs
              </h4>
              <p class="persona-description" data-translate="persona-hubs-desc">
                Innovation support and startup resources
              </p>
            </div>
          </div>
        </section>

        <!-- Quick Actions -->
        <section class="quick-actions" style="margin: 0 1.5rem 3rem 1.5rem">
          <h3
            style="
              font-size: 2rem;
              font-weight: 700;
              color: var(--green-dark);
              margin-bottom: 1.5rem;
            "
          >
            Quick Actions
          </h3>
          <div class="quick-actions-grid">
            <div class="quick-action-card">
              <h4 class="quick-action-title">Recent Activity</h4>
              <div class="activity-item">
                <div class="activity-dot green"></div>
                <span class="activity-text">Funding application submitted</span>
              </div>
              <div class="activity-item">
                <div class="activity-dot accent"></div>
                <span class="activity-text">New SMME verified</span>
              </div>
              <div class="activity-item">
                <div class="activity-dot green"></div>
                <span class="activity-text">Toolkit downloaded</span>
              </div>
            </div>

            <div class="quick-action-card">
              <h4 class="quick-action-title">Featured Resources</h4>
              <div class="resource-item">
                <div class="resource-title">Green Energy Guide</div>
                <div class="resource-description">
                  Complete solar installation toolkit
                </div>
              </div>
              <div class="resource-item">
                <div class="resource-title">Carbon Credit Calculator</div>
                <div class="resource-description">
                  Measure your environmental impact
                </div>
              </div>
              <div class="resource-item">
                <div class="resource-title">Sustainability Certification</div>
                <div class="resource-description">
                  Get certified for green practices
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Footer -->
    <green-economy-footer></green-economy-footer>

    <!-- AI Assistant Button -->
    <div class="ai-assistant-btn" onclick="openAIAssistant()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
        ></path>
      </svg>
    </div>

    <!-- AI Assistant Modal -->
    <div id="aiModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeAIAssistant()">×</span>
        <div class="chat-container">
          <h3 data-translate="ai-assistant-title">AI Assistant</h3>
          <div class="chat-messages" id="chatMessages">
            <div class="message ai">
              <div class="message-content" data-translate="ai-welcome">
                Sawubona! Hello! Dumelang! 🌱 I'm your Green Economy AI
                Assistant. I can help you in isiZulu, English, or Tswana. How
                can I assist you with green economy opportunities today?
              </div>
            </div>
          </div>
          <div class="chat-input-container">
            <input
              type="text"
              id="chatInput"
              class="chat-input"
              placeholder="Ask me about green economy opportunities..."
              data-translate-placeholder="ai-input-placeholder"
            />
            <button class="chat-send" onclick="sendMessage()">
              <svg
                width="20"
                height="20"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
    // Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyAIlr8Y249Yu_1JPbUjNX7cQtJYlkbV3eY",
    authDomain: "nbi-database.firebaseapp.com",
    projectId: "nbi-database",
    storageBucket: "nbi-database.appspot.com",
    messagingSenderId: "497517200595",
    appId: "1:497517200595:web:c862996d49fba97baf8026",
    measurementId: "G-NHZB2WJF9L"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Loader Functions
function showLoader() {
    const loader = document.getElementById('loader');
    const loaderOverlay = document.getElementById('loader-overlay');
    if (loader && loaderOverlay) {
        loader.style.display = 'block';
        loaderOverlay.style.display = 'block';
    } else {
        console.warn("Loader elements not found in DOM");
    }
}

function hideLoader() {
    const loader = document.getElementById('loader');
    const loaderOverlay = document.getElementById('loader-overlay');
    if (loader && loaderOverlay) {
        loader.style.display = 'none';
        loaderOverlay.style.display = 'none';
    }
}

// Interaction Tracking Function
function trackUserInteraction(category, action, label = "") {
    const user = auth.currentUser;
    if (user) {
        db.collection('interactions').add({
            userId: user.uid,
            category: category,
            action: action,
            label: label,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            language: currentLanguage || 'en',
            userAgent: navigator.userAgent
        }).catch((error) => {
            console.error("Error logging interaction to Firestore: ", error);
        });
    } else {
        console.log("No user logged in, interaction tracked locally:", { category, action, label });
    }
}

// Translations
const translations = {
    en: {
        "dashboard-title": "Dashboard Overview",
        "dashboard-subtitle": "Welcome to your personalized Green Economy Toolkit dashboard",
        "ai-search-title": "AI-Enhanced Search",
        "search-placeholder": "Search green funding, businesses, tools...",
        "funding-hub-title": "Funding Hub",
        "funding-hub-desc": "Explore green funding opportunities with real-time updates and eligibility filters.",
        "smme-directory-title": "SMME Directory",
        "smme-directory-desc": "Searchable database with business profiles and green certification statuses.",
        "toolkits-title": "Integrated Toolkits",
        "toolkits-desc": "Access green economy tools and seamless redirects to external applications.",
        "legal-title": "Legal & Compliance",
        "legal-desc": "Clearly defined policies and limited liability statements integrated into the platform.",
        "personas-title": "Built for Every Green Economy Participant",
        "ai-assistant-title": "AI Assistant",
        "ai-welcome": "Sawubona! Hello! Dumelang! 🌱 I'm your Green Economy AI Assistant. I can help you in isiZulu, English, or Tswana. How can I assist you with green economy opportunities today?",
        "ai-input-placeholder": "Ask me about green economy opportunities..."
    },
    zu: {
        "dashboard-title": "Ukubuka Idashboard",
        "dashboard-subtitle": "Wamukelekile ku-Green Economy Toolkit dashboard yakho",
        "ai-search-title": "Ukusesha Okuhlakanipha nge-AI",
        "search-placeholder": "Sesha amathuba okuphila okuluhlaza...",
        "funding-hub-title": "Indawo Yezimali",
        "funding-hub-desc": "Hlola amathuba ezimali eziluhlaza ngokubuyekezwa kwesikhathi sangempela.",
        "smme-directory-title": "Uhlu Lwamabhizinisi Amancane",
        "smme-directory-desc": "Isizindalwazi esiseshekayo namaphrofayela amabhizinisi nezimo zokuqinisekisa okuluhlaza.",
        "toolkits-title": "Amatulusi Ahlanganisiwe",
        "toolkits-desc": "Finyelela amatulusi omnotho oluhlaza kanye nokudlulisela ngaphandle koluleko.",
        "legal-title": "Ezomthetho Nokulandela",
        "legal-desc": "Izinqubomgomo ezicacile nezitatimende zomthwalo ohlinzekwe endaweni.",
        "personas-title": "Yakhelwe Bonke Abahlanganyeli Bomnotho Oluhlaza",
        "ai-assistant-title": "Umsizi we-AI",
        "ai-welcome": "Sawubona! 🌱 NginguMsizi wakho we-AI womnotho oluhlaza. Ngingakusiza ngesiZulu, isiNgisi, noma isiTswana. Ngingakusiza kanjani namathuba omnotho oluhlaza namuhla?",
        "ai-input-placeholder": "Ngibuze ngamathuba omnotho oluhlaza..."
    },
    tn: {
        "dashboard-title": "Ponopesiso ya Dashboard",
        "dashboard-subtitle": "Amogelesegang ko dashboard ya gago ya Green Economy Toolkit",
        "ai-search-title": "Batla ka AI e e Botlhale",
        "search-placeholder": "Batla ditšhono tsa ikonomi e tala...",
        "funding-hub-title": "Lefelo la Madi",
        "funding-hub-desc": "Sekaseka ditšhono tsa madi a tala ka diphetogo tsa nako ya nnete.",
        "smme-directory-title": "Lenaane la Dikgwebo Dinnye",
        "smme-directory-desc": "Database e e batlang le diprofaele tsa dikgwebo le maemo a netefatso e tala.",
        "toolkits-title": "Didirišwa tše di Kopantšwego",
        "toolkits-desc": "Hwetša didirišwa tsa ikonomi e tala le diphetišetšo tše di se nago bothata.",
        "legal-title": "Semolao le Go Latela",
        "legal-desc": "Melawana e e tlhalogantšegago le dipego tsa boikarabelo tše di akaretšweng.",
        "personas-title": "E Agilwe Batšeakarolo Botlhe ba Ikonomi e Tala",
        "ai-assistant-title": "Mothusi wa AI",
        "ai-welcome": "Dumelang! 🌱 Ke Mothusi wa gago wa AI wa ikonomi e tala. Nka go thuša ka Setswana, Sekgowa kgotsa isiZulu. Nka go thuša jang ka ditšhono tsa ikonomi e tala gompieno?",
        "ai-input-placeholder": "Mpotse ka ditšhono tsa ikonomi e tala..."
    }
};

// Fallback news data
const fallbackNewsData = [
    {
        id: "1",
        title: "South Africa Launches New Green Energy Initiative",
        description: "The government announces a R10 billion investment in renewable energy projects across the country, focusing on solar and wind power development.",
        category: "Energy",
        source: "Green Economy SA",
        time: "2h ago",
        image: "https://images.pexels.com/photos/371917/pexels-photo-371917.jpeg",
        url: "#"
    },
    {
        id: "2",
        title: "New Carbon Credit Trading Platform Launched",
        description: "A groundbreaking platform connects South African businesses with international carbon credit markets, enabling sustainable revenue streams.",
        category: "Finance",
        source: "Carbon Market News",
        time: "4h ago",
        image: "https://images.pexels.com/photos/371917/pexels-photo-371917.jpeg",
        url: "#"
    },
    {
        id: "3",
        title: "SMME Green Certification Program Expands",
        description: "Over 1,000 small businesses have now received green economy certifications, boosting their market competitiveness and sustainability credentials.",
        category: "Business",
        source: "SMME Today",
        time: "6h ago",
        image: "https://images.pexels.com/photos/371917/pexels-photo-371917.jpeg",
        url: "#"
    },
    {
        id: "4",
        title: "Revolutionary Water Conservation Technology",
        description: "Local innovators develop smart irrigation systems that reduce water usage by 40% while maintaining crop yields, attracting international investment.",
        category: "Technology",
        source: "AgriTech News",
        time: "8h ago",
        image: "https://images.pexels.com/photos/371917/pexels-photo-371917.jpeg",
        url: "#"
    },
    {
        id: "5",
        title: "Green Skills Training Centers Opening Nationwide",
        description: "TVET colleges across South Africa launch specialized green economy training programs, preparing youth for sustainable career opportunities.",
        category: "Education",
        source: "Education Herald",
        time: "1d ago",
        image: "https://images.pexels.com/photos/371917/pexels-photo-371917.jpeg",
        url: "#"
    },
    {
        id: "6",
        title: "Clean Energy Jobs Surge in Western Cape",
        description: "The renewable energy sector creates over 5,000 new jobs in the Western Cape, providing opportunities for local communities and driving economic growth.",
        category: "Energy",
        source: "Cape Business News",
        time: "1d ago",
        image: "https://images.pexels.com/photos/371917/pexels-photo-371917.jpeg",
        url: "#"
    }
];

let newsData = [];
let currentLanguage = "en";
let currentNewsCategory = "all";
let displayedNewsCount = 4;
let chatMessages = [];
const API_KEY = "e00b07155a6c49aa90b8f84ad3115ec1"; // Replace with your NewsAPI key
const DEFAULT_IMAGE = "https://images.pexels.com/photos/371917/pexels-photo-371917.jpeg";

// Initialize the page
document.addEventListener("DOMContentLoaded", function () {
    console.log("DOM loaded, waiting for authentication and custom elements...");
    auth.onAuthStateChanged((user) => {
        if (!user) {
            console.log("No user logged in, redirecting to sign-in...");
            showLoader();
            window.location.href = '../Sign In & Sign Up/SignIn.html';
            return;
        }
        console.log("User authenticated:", user.uid);
        Promise.all([
            customElements.whenDefined("green-economy-header").catch(() => console.warn("Header not defined")),
            customElements.whenDefined("green-economy-footer").catch(() => console.warn("Footer not defined"))
        ]).then(() => {
            console.log("Custom elements loaded, initializing dashboard...");
            initializeSearch();
            initializeDashboard();
            initializeNews();
            updateLanguage(currentLanguage);
            trackUserInteraction("page", "loaded", "dashboard");
        }).catch((error) => {
            console.error("Error with custom elements:", error);
            // Fallback initialization after 1 second
            setTimeout(() => {
                console.log("Fallback initialization triggered");
                initializeSearch();
                initializeDashboard();
                initializeNews();
                updateLanguage(currentLanguage);
                trackUserInteraction("page", "loaded", "dashboard");
            }, 1000);
        });
    });
});

// Language Management
function changeLanguage(lang) {
    currentLanguage = lang;
    const languageSelector = document.getElementById("languageSelector");
    if (languageSelector) {
        languageSelector.value = lang;
    } else {
        console.warn("Language selector not found");
    }
    updateLanguage(lang);
    trackUserInteraction("language", "changed", lang);
}

function updateLanguage(lang) {
    const elements = document.querySelectorAll("[data-translate]");
    elements.forEach((element) => {
        const key = element.getAttribute("data-translate");
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });

    const placeholderElements = document.querySelectorAll("[data-translate-placeholder]");
    placeholderElements.forEach((element) => {
        const key = element.getAttribute("data-translate-placeholder");
        if (translations[lang] && translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });
}

// Smart Search Functionality
function initializeSearch() {
    const searchInput = document.getElementById("smartSearch");
    if (!searchInput) {
        console.warn("Search input not found");
        return;
    }
    let searchTimeout;

    searchInput.addEventListener("input", function (e) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            performSearch(e.target.value);
        }, 300);
    });

    searchInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            performSearch(e.target.value);
        }
    });
}

function performSearch(query) {
    if (query.length < 2) return;
    trackUserInteraction("search", "query", query);
    console.log(`Searching for: ${query}`);
}

// Dashboard Functionality
function initializeDashboard() {
    const dashboardCards = document.querySelectorAll(".dashboard-card");
    console.log("Found dashboard cards:", dashboardCards.length);
    if (dashboardCards.length === 0) {
        console.warn("No dashboard cards found. Check HTML class '.dashboard-card' and DOM loading.");
        // Retry after 2 seconds
        setTimeout(initializeDashboard, 2000);
        return;
    }
    dashboardCards.forEach((card, index) => {
        // Remove existing listeners to prevent duplicates
        card.removeEventListener("click", handleCardClick);
        card.addEventListener("click", handleCardClick);
        console.log(`Attached click listener to card ${index}: ${card.getAttribute("data-section")}`);
    });
}

function handleCardClick(event) {
    event.preventDefault();
    event.stopPropagation();
    const section = this.getAttribute("data-section");
    console.log("Card clicked, section:", section);
    navigateToSection(section);
}

function navigateToSection(section) {
    trackUserInteraction("navigation", `click_${section}`);
    const paths = {
        funding: "../Funding Hub/Funding-Hub.html",
        smme: "../SMME/smme.html",
        toolkits: "../ToolKits/toolkits.html",
        legal: "../Legal/legal.html"
    };
    if (paths[section]) {
        console.log("Navigating to:", paths[section]);
        showLoader();
        // Test path accessibility
        fetch(paths[section], { method: 'HEAD' })
            .then(response => {
                if (response.ok) {
                    window.location.href = paths[section];
                } else {
                    console.error(`Navigation failed: ${paths[section]} not found (Status: ${response.status})`);
                    displayErrorMessage(`Cannot navigate to ${section}: Page not found.`);
                    hideLoader();
                }
            })
            .catch(error => {
                console.error(`Navigation error for ${section}:`, error);
                displayErrorMessage(`Navigation error: Unable to access ${section}.`);
                hideLoader();
            });
    } else {
        console.error("Invalid section:", section);
        displayErrorMessage("Navigation error: Section not found.");
        hideLoader();
    }
}

// News Management Functions
async function initializeNews() {
    const newsGrid = document.getElementById("newsGrid");
    if (!newsGrid) {
        console.warn("News grid not found, skipping news initialization");
        return;
    }
    await fetchNews();
    renderNews();
    setupNewsEventListeners();
    setInterval(updateNews, 30000);
}

async function fetchNews() {
    const query = "green economy OR renewable energy OR sustainable finance OR green technology OR SMME OR sustainability education +South Africa";
    const url = `https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&language=en&sortBy=publishedAt&apiKey=${API_KEY}`;

    try {
        showLoader();
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const data = await response.json();

        newsData = data.articles
            .filter(article => article.title && article.description && article.url && article.source.name)
            .map((article, index) => {
                const content = `${article.title.toLowerCase()} ${article.description.toLowerCase()}`;
                let category = "Business";
                if (content.includes("energy") || content.includes("solar") || content.includes("wind")) category = "Energy";
                else if (content.includes("finance") || content.includes("funding") || content.includes("carbon credit")) category = "Finance";
                else if (content.includes("technology") || content.includes("innovation")) category = "Technology";
                else if (content.includes("education") || content.includes("training") || content.includes("skills")) category = "Education";

                const publishedAt = new Date(article.publishedAt);
                const now = new Date();
                const diffMs = now - publishedAt;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const time = diffHours < 24 ? `${diffHours}h ago` : `${Math.floor(diffHours / 24)}d ago`;

                return {
                    id: `news-${index}-${Date.now()}`,
                    title: article.title,
                    description: article.description.length > 150 ? article.description.substring(0, 147) + "..." : article.description,
                    category: category,
                    source: article.source.name,
                    time: time,
                    image: article.urlToImage || DEFAULT_IMAGE,
                    url: article.url
                };
            })
            .slice(0, 20);

        if (newsData.length === 0) {
            console.warn("No valid articles found, using fallback data");
            newsData = [...fallbackNewsData];
        }
    } catch (error) {
        console.error("Error fetching news:", error);
        newsData = [...fallbackNewsData];
        displayErrorMessage("Failed to load news. Showing cached content.");
    } finally {
        hideLoader();
    }
}

function displayErrorMessage(message) {
    const newsGrid = document.getElementById("newsGrid");
    if (!newsGrid) {
        console.warn("Cannot display error message: News grid not found");
        return;
    }
    const errorDiv = document.createElement("div");
    errorDiv.className = "news-error";
    errorDiv.style = "color: red; text-align: center; padding: 1rem; font-weight: 500;";
    errorDiv.textContent = message;
    newsGrid.prepend(errorDiv);
    setTimeout(() => errorDiv.remove(), 5000);
}

function renderNews() {
    const newsGrid = document.getElementById("newsGrid");
    if (!newsGrid) {
        console.warn("News grid not found, cannot render news");
        return;
    }
    const filteredNews = currentNewsCategory === "all" ? newsData : newsData.filter((news) => news.category === currentNewsCategory);
    const newsToShow = filteredNews.slice(0, displayedNewsCount);

    if (newsToShow.length === 0) {
        newsGrid.innerHTML = '<p style="text-align: center; color: #666;">No news available for this category.</p>';
        return;
    }

    newsGrid.innerHTML = newsToShow
        .map(
            (news) => `
                <div class="news-item" onclick="openNewsArticle('${news.id}')">
                    <img src="${news.image}" alt="${news.title}" class="news-image" onerror="this.src='${DEFAULT_IMAGE}'">
                    <div class="news-content">
                        <div class="news-category ${news.category}">${news.category}</div>
                        <h4 class="news-title">${news.title}</h4>
                        <p class="news-description">${news.description}</p>
                        <div class="news-meta">
                            <span class="news-source">${news.source}</span>
                            <div class="news-time">
                                <svg style="width: 0.75rem; height: 0.75rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                ${news.time}
                            </div>
                        </div>
                    </div>
                </div>
            `
        )
        .join("");

    const loadMoreBtn = document.getElementById("loadMoreNews");
    if (loadMoreBtn) {
        loadMoreBtn.style.display = displayedNewsCount >= filteredNews.length ? "none" : "inline-block";
    } else {
        console.warn("Load more button not found");
    }
}

function setupNewsEventListeners() {
    const categoryBtns = document.querySelectorAll(".news-category-btn");
    console.log("Found news category buttons:", categoryBtns.length);
    if (categoryBtns.length === 0) {
        console.warn("No news category buttons found");
    }
    categoryBtns.forEach((btn, index) => {
        btn.removeEventListener("click", handleCategoryClick);
        btn.addEventListener("click", handleCategoryClick);
        console.log(`Attached click listener to category button ${index}: ${btn.getAttribute("data-category")}`);
    });

    const loadMoreBtn = document.getElementById("loadMoreNews");
    if (loadMoreBtn) {
        loadMoreBtn.removeEventListener("click", handleLoadMoreClick);
        loadMoreBtn.addEventListener("click", handleLoadMoreClick);
        console.log("Attached click listener to load more button");
    } else {
        console.warn("Load more button not found");
    }

    const refreshBtn = document.getElementById("refreshNews");
    if (refreshBtn) {
        refreshBtn.removeEventListener("click", handleRefreshClick);
        refreshBtn.addEventListener("click", handleRefreshClick);
        console.log("Attached click listener to refresh button");
    } else {
        console.warn("Refresh button not found");
    }
}

function handleCategoryClick() {
    const categoryBtns = document.querySelectorAll(".news-category-btn");
    categoryBtns.forEach((b) => b.classList.remove("active"));
    this.classList.add("active");
    currentNewsCategory = this.getAttribute("data-category");
    displayedNewsCount = 4;
    console.log("Category filter clicked:", currentNewsCategory);
    renderNews();
    trackUserInteraction("news", "category_filter", currentNewsCategory);
}

function handleLoadMoreClick() {
    displayedNewsCount += 2;
    console.log("Load more clicked, displaying:", displayedNewsCount);
    renderNews();
    trackUserInteraction("news", "load_more");
}

function handleRefreshClick() {
    console.log("Refresh news clicked");
    fetchNews().then(() => {
        renderNews();
        trackUserInteraction("news", "refresh");
    });
}

function openNewsArticle(newsId) {
    const news = newsData.find((n) => n.id === newsId);
    if (news && news.url) {
        console.log("Opening news article:", news.title);
        trackUserInteraction("news", "article_click", news.title);
        window.open(news.url, "_blank");
    } else {
        console.error("Article not found or no URL available:", newsId);
        displayErrorMessage("Unable to open article.");
    }
}

async function updateNews() {
    console.log("Auto-updating news...");
    await fetchNews();
    renderNews();
    trackUserInteraction("news", "auto_update");
}

// AI Assistant Functionality
function openAIAssistant() {
    const modal = document.getElementById("aiModal");
    if (modal) {
        modal.style.display = "flex";
        console.log("AI assistant modal opened");
        trackUserInteraction("ai_assistant", "opened");
    } else {
        console.warn("AI modal not found");
    }
}

function closeAIAssistant() {
    const modal = document.getElementById("aiModal");
    if (modal) {
        modal.style.display = "none";
        console.log("AI assistant modal closed");
        trackUserInteraction("ai_assistant", "closed");
    }
}

function sendMessage() {
    const input = document.getElementById("chatInput");
    if (!input) {
        console.warn("Chat input not found");
        return;
    }
    const message = input.value.trim();
    if (!message) return;

    addMessage(message, "user");
    input.value = "";
    console.log("AI chat message sent:", message);
    trackUserInteraction("ai_chat", "message_sent");

    setTimeout(() => {
        const aiResponse = generateAIResponse(message);
        addMessage(aiResponse, "ai");
    }, 1000);
}

function addMessage(content, sender) {
    const messagesContainer = document.getElementById("chatMessages");
    if (!messagesContainer) {
        console.warn("Chat messages container not found");
        return;
    }
    const messageDiv = document.createElement("div");
    messageDiv.className = `message ${sender}`;
    messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    chatMessages.push({ content, sender, timestamp: new Date() });
}

function generateAIResponse(userMessage) {
    const responses = {
        en: [
            "I can help you find green funding opportunities. What type of project are you working on?",
            "Let me connect you with relevant SMME businesses in your area. What industry are you interested in?",
            "I can guide you to the right sustainability toolkit. What environmental challenge are you facing?",
            "Great question! I can help you understand the legal requirements for green business certification."
        ],
        zu: [
            "Ngingakusiza ukuthola amathuba ezimali eziluhlaza. Yiluphi uhlobo lwephrojekthi osebenza ngalo?",
            "Ake ngikuxhumanise namabhizinisi afanele endaweni yakho. Yimuphi umkhakha onomdla ngawo?",
            "Ngingakuqondisa kutulusi efanele. Yiyiphi inselelo yendalo obhekane nayo?",
            "Umbuzo omuhle! Ngingakusiza ukuqonda izidingo zomthetho zokuqinisekisa ibhizinisi eliluhlaza."
        ],
        tn: [
            "Nka go thuša go bona ditšhono tsa madi a tala. Ke morojwa ofe o o sebetsang ka ona?",
            "A ke go golagane le dikgwebo tše di maleba mo kgaolong ya gago. Ke intasteri efe e o nang le kgatlhego go yona?",
            "Nka go dira gore o itekanele le sebereka se se maleba. Ke tlhohlo efe ya tikologo e o lebaneng le yona?",
            "Potšišo e botse! Nka go thuša go tlhaloganya ditlhokwa tsa semolao tsa netefatso ya dikgwebo tše di tala."
        ]
    };
    const langResponses = responses[currentLanguage] || responses.en;
    return langResponses[Math.floor(Math.random() * langResponses.length)];
}

// Event Listeners
document.addEventListener("DOMContentLoaded", function () {
    const languageSelector = document.getElementById("languageSelector");
    if (languageSelector) {
        languageSelector.addEventListener("change", function (e) {
            console.log("Language selector changed to:", e.target.value);
            changeLanguage(e.target.value);
        });
    } else {
        console.warn("Language selector not found");
    }

    const chatInput = document.getElementById("chatInput");
    if (chatInput) {
        chatInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                console.log("Enter key pressed in chat input");
                sendMessage();
            }
        });
    } else {
        console.warn("Chat input not found");
    }

    window.addEventListener("click", function (e) {
        const modal = document.getElementById("aiModal");
        if (e.target === modal) {
            console.log("Clicked outside AI modal, closing...");
            closeAIAssistant();
        }
    });

    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute("href"));
            if (target) {
                console.log("Smooth scrolling to:", this.getAttribute("href"));
                target.scrollIntoView({ behavior: "smooth", block: "start" });
            } else {
                console.warn("Scroll target not found:", this.getAttribute("href"));
            }
        });
    });
});
    </script>
  </body>
</html>